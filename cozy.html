<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0"
    />
    <title>
      Cozy LoFi Chill - Focus Mode
    </title>
    <!-- Favicon -->
    <link
      rel="icon"
      href="https://cdn-icons-png.flaticon.com/512/3652/3652191.png"
      type="image/png"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <style>
      :root {
        --background-color: rgba(
          26,
          26,
          26,
          0.8
        );
        --text-color: #e0e0e0;
        --accent-color: #1e3a8a;
        --secondary-background: rgba(
          44,
          44,
          44,
          0.8
        );
        --card-bg: rgba(
          51,
          51,
          51,
          0.8
        );
        --card-shadow: 0 4px 6px
          rgba(0, 0, 0, 0.1);
        --border-radius: 12px;
        --transition: all 0.3s ease;
      }

      [data-theme="light"] {
        --background-color: rgba(
          249,
          249,
          249,
          0.8
        );
        --text-color: #333;
        --secondary-background: rgba(
          255,
          255,
          255,
          0.8
        );
        --card-bg: rgba(
          255,
          255,
          255,
          0.8
        );
        --card-shadow: 0 4px 6px
          rgba(0, 0, 0, 0.05);
      }

      body {
        margin: 0;
        font-family: "Inter", sans-serif;
        background-color: transparent;
        color: var(--text-color);
        line-height: 1.6;
        transition: var(--transition);
      }

      h1,
      h2,
      h3 {
        margin: 0;
        font-weight: 600;
      }

      h1 {
        font-size: 3rem;
      }
      h2 {
        font-size: 2rem;
        color: var(--accent-color);
      }
      p {
        font-size: 1rem;
        color: var(--text-color);
      }
      a {
        color: var(--accent-color);
        text-decoration: none;
        transition: var(--transition);
      }
      a:hover {
        opacity: 0.8;
      }

      .video-background {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: -1;
        overflow: hidden;
      }

      .video-background video {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        object-fit: cover;
        transform: translateZ(0);
        will-change: transform;
      }

      .video-overlay {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        z-index: 1;
      }

      .hero {
        position: relative;
        height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
        text-align: center;
        z-index: 2;
      }

      .hero-content {
        color: #fff;
      }
      .hero-content h1 {
        font-size: 4rem;
        margin-bottom: 10px;
      }
      .hero-content p {
        font-size: 1.5rem;
        opacity: 0.9;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 40px 20px;
        position: relative;
        z-index: 2;
        background-color: var(
          --background-color
        );
        border-radius: var(
          --border-radius
        );
        box-shadow: var(--card-shadow);
        margin-top: 20px;
        backdrop-filter: blur(10px);
      }

      .card {
        background-color: var(
          --card-bg
        );
        padding: 20px;
        border-radius: var(
          --border-radius
        );
        box-shadow: var(--card-shadow);
        margin-bottom: 20px;
        transition: var(--transition);
        display: flex;
        align-items: center;
        gap: 20px;
        backdrop-filter: blur(10px);
      }

      .card:hover {
        transform: translateY(-5px);
        box-shadow: 0 6px 12px
          rgba(0, 0, 0, 0.15);
      }

      .card-icon {
        font-size: 2rem;
        color: var(--accent-color);
      }

      .card-content {
        flex: 1;
      }

      .pomodoro-timer {
        text-align: center;
      }
      .timer-display {
        font-size: 3rem;
        margin: 20px 0;
        font-weight: 600;
      }

      .timer-controls {
        display: flex;
        justify-content: center;
        gap: 10px;
        margin-bottom: 20px;
      }

      .timer-controls button {
        background-color: var(
          --accent-color
        );
        color: #fff;
        border: none;
        padding: 10px 20px;
        border-radius: var(
          --border-radius
        );
        cursor: pointer;
        transition: var(--transition);
      }

      .timer-controls button:hover {
        background-color: #1d4ed8;
      }

      .timer-settings {
        display: flex;
        justify-content: center;
        gap: 20px;
        margin-bottom: 20px;
      }

      .timer-settings input {
        width: 60px;
        padding: 5px;
        border: 1px solid
          var(--secondary-background);
        border-radius: var(
          --border-radius
        );
        background-color: var(
          --secondary-background
        );
        color: var(--text-color);
        text-align: center;
      }

      .analog-clock {
        display: flex;
        justify-content: center;
        align-items: center;
        margin-left: 20px;
      }

      .clock-face {
        width: 120px;
        height: 120px;
        border: 6px solid
          var(--accent-color);
        border-radius: 50%;
        position: relative;
      }

      .hand {
        position: absolute;
        top: 50%;
        left: 50%;
        transform-origin: 50% 100%;
        background-color: var(
          --text-color
        );
        transition: transform 0.05s
          cubic-bezier(0.4, 2.3, 0.6, 1);
      }

      .hour-hand {
        width: 4px;
        height: 30px;
        margin-top: -30px;
      }
      .minute-hand {
        width: 3px;
        height: 40px;
        margin-top: -40px;
      }
      .second-hand {
        width: 2px;
        height: 45px;
        margin-top: -45px;
        background-color: var(
          --accent-color
        );
      }

      .todo-input {
        display: flex;
        gap: 10px;
        margin-bottom: 20px;
      }

      .todo-input input {
        flex: 1;
        padding: 10px;
        border: 1px solid
          var(--secondary-background);
        border-radius: var(
          --border-radius
        );
        background-color: var(
          --secondary-background
        );
        color: var(--text-color);
      }

      .todo-input button {
        background-color: var(
          --accent-color
        );
        color: #fff;
        border: none;
        padding: 10px 20px;
        border-radius: var(
          --border-radius
        );
        cursor: pointer;
        transition: var(--transition);
      }

      .todo-input button:hover {
        background-color: #1d4ed8;
      }

      .todo-items {
        list-style: none;
        padding: 0;
      }

      .todo-items li {
        background-color: var(
          --secondary-background
        );
        padding: 10px;
        margin: 5px 0;
        border-radius: var(
          --border-radius
        );
        display: flex;
        justify-content: space-between;
        align-items: center;
        transition: var(--transition);
      }

      .todo-items li.completed {
        text-decoration: line-through;
        opacity: 0.7;
      }

      .todo-items li .task-text {
        flex-grow: 1;
      }
      .todo-items li .task-buttons {
        display: flex;
        gap: 5px;
      }

      .todo-items li button {
        background-color: var(
          --accent-color
        );
        color: #fff;
        border: none;
        padding: 5px 10px;
        border-radius: var(
          --border-radius
        );
        cursor: pointer;
        transition: var(--transition);
      }

      .todo-items li button:hover {
        background-color: #1d4ed8;
      }

      .spotify-controls {
        display: flex;
        gap: 10px;
        margin-bottom: 15px;
      }

      .spotify-controls input {
        flex: 1;
        padding: 10px;
        border: 1px solid
          var(--secondary-background);
        border-radius: var(
          --border-radius
        );
        background-color: var(
          --secondary-background
        );
        color: var(--text-color);
      }

      .spotify-controls button {
        background-color: var(
          --accent-color
        );
        color: #fff;
        border: none;
        padding: 10px 20px;
        border-radius: var(
          --border-radius
        );
        cursor: pointer;
        transition: var(--transition);
      }

      .spotify-controls button:hover {
        background-color: #1d4ed8;
      }

      .spotify-grid {
        display: grid;
        grid-template-columns: repeat(
          2,
          1fr
        );
        gap: 20px;
      }

      .spotify-player iframe {
        width: 100%;
        height: 80px;
        border-radius: var(
          --border-radius
        );
      }

      /* Workout Planner Styles */
      .workout-planner {
        width: 100%;
      }

      .workout-day {
        margin-bottom: 20px;
        background-color: var(
          --secondary-background
        );
        padding: 15px;
        border-radius: var(
          --border-radius
        );
      }

      .workout-day-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 10px;
      }

      .workout-day-title {
        font-weight: 600;
        color: var(--accent-color);
      }

      .workout-exercises {
        margin-left: 20px;
      }

      .workout-exercise {
        display: flex;
        justify-content: space-between;
        margin-bottom: 8px;
        padding: 8px;
        background-color: var(
          --card-bg
        );
        border-radius: var(
          --border-radius
        );
      }

      .workout-controls {
        display: flex;
        gap: 10px;
        margin-bottom: 15px;
      }

      .workout-controls button {
        background-color: var(
          --accent-color
        );
        color: #fff;
        border: none;
        padding: 8px 15px;
        border-radius: var(
          --border-radius
        );
        cursor: pointer;
        transition: var(--transition);
      }

      .workout-controls button:hover {
        background-color: #1d4ed8;
      }

      .exercise-inputs {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
        align-items: center;
        flex: 1;
      }

      .exercise-inputs input {
        padding: 8px;
        border: 1px solid
          var(--secondary-background);
        border-radius: var(
          --border-radius
        );
        background-color: var(
          --secondary-background
        );
        color: var(--text-color);
      }

      .exercise-inputs
        input[type="time"] {
        width: 120px;
      }

      .exercise-actions {
        display: flex;
        gap: 5px;
      }

      .exercise-actions button {
        background-color: var(
          --accent-color
        );
        color: #fff;
        border: none;
        padding: 3px 8px;
        border-radius: var(
          --border-radius
        );
        cursor: pointer;
        font-size: 0.8rem;
      }

      .delete-exercise {
        background-color: #dc2626 !important;
        padding: 5px 10px !important;
      }

      .calendar-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
      }

      .calendar-header button {
        background-color: var(
          --accent-color
        );
        color: #fff;
        border: none;
        padding: 5px 10px;
        border-radius: var(
          --border-radius
        );
        cursor: pointer;
        transition: var(--transition);
      }

      .calendar-header button:hover {
        background-color: #1d4ed8;
      }

      .calendar-grid {
        display: grid;
        grid-template-columns: repeat(
          7,
          1fr
        );
        gap: 10px;
      }

      .calendar-day {
        background-color: var(
          --secondary-background
        );
        padding: 10px;
        text-align: center;
        border-radius: var(
          --border-radius
        );
        cursor: pointer;
        transition: var(--transition);
        position: relative;
        min-height: 40px;
      }

      .calendar-day.empty {
        background-color: transparent;
        cursor: default;
      }

      .calendar-day.event {
        background-color: var(
          --accent-color
        );
        color: #fff;
      }

      .calendar-day.event::after {
        content: "•";
        position: absolute;
        top: 2px;
        right: 5px;
        font-size: 18px;
      }

      footer {
        text-align: center;
        padding: 20px;
        background-color: var(
          --secondary-background
        );
        color: var(--text-color);
        margin-top: 40px;
        border-radius: var(
          --border-radius
        );
        position: relative;
        z-index: 2;
        backdrop-filter: blur(10px);
      }

      .theme-toggle {
        position: fixed;
        top: 20px;
        right: 20px;
        z-index: 1000;
      }

      .theme-toggle input {
        display: none;
      }
      .theme-toggle label {
        display: block;
        width: 50px;
        height: 25px;
        background-color: var(
          --secondary-background
        );
        border-radius: 25px;
        position: relative;
        cursor: pointer;
        transition: var(--transition);
      }

      .theme-toggle label::after {
        content: "";
        position: absolute;
        top: 2px;
        left: 2px;
        width: 21px;
        height: 21px;
        background-color: var(
          --accent-color
        );
        border-radius: 50%;
        transition: var(--transition);
      }

      .theme-toggle
        input:checked
        + label::after {
        transform: translateX(25px);
      }

      .auth-buttons {
        position: fixed;
        top: 20px;
        left: 20px;
        z-index: 1000;
        display: flex;
        gap: 10px;
      }

      .auth-buttons button {
        background-color: var(
          --accent-color
        );
        color: #fff;
        border: none;
        padding: 10px 20px;
        border-radius: var(
          --border-radius
        );
        cursor: pointer;
        transition: var(--transition);
      }

      .auth-buttons button:hover {
        background-color: #1d4ed8;
      }

      #logout-btn {
        background-color: #dc2626;
      }
      #logout-btn:hover {
        background-color: #b91c1c;
      }

      .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(
          0,
          0,
          0,
          0.5
        );
        z-index: 1001;
        justify-content: center;
        align-items: center;
      }

      .modal-content {
        background-color: var(
          --card-bg
        );
        padding: 20px;
        border-radius: var(
          --border-radius
        );
        box-shadow: var(--card-shadow);
        width: 300px;
        text-align: center;
      }

      .modal-content h2 {
        margin-bottom: 20px;
      }
      .modal-content input {
        width: 100%;
        padding: 10px;
        margin: 10px 0;
        border: 1px solid
          var(--secondary-background);
        border-radius: var(
          --border-radius
        );
        background-color: var(
          --secondary-background
        );
        color: var(--text-color);
      }

      .modal-content button {
        width: 100%;
        padding: 10px;
        background-color: var(
          --accent-color
        );
        color: #fff;
        border: none;
        border-radius: var(
          --border-radius
        );
        cursor: pointer;
        transition: var(--transition);
      }

      .modal-content button:hover {
        background-color: #1d4ed8;
      }
      .modal-content .switch {
        margin-top: 10px;
        color: var(--accent-color);
        cursor: pointer;
      }

      .modal-content .switch:hover {
        text-decoration: underline;
      }
      .modal-content .error {
        color: red;
        margin-top: 10px;
      }

      .event-popup {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(
          -50%,
          -50%
        );
        background-color: var(
          --card-bg
        );
        padding: 20px;
        border-radius: var(
          --border-radius
        );
        box-shadow: var(--card-shadow);
        z-index: 1002;
        max-width: 300px;
        width: 90%;
      }

      .event-popup h3 {
        margin-top: 0;
        color: var(--accent-color);
      }
      .event-popup p {
        margin-bottom: 15px;
      }

      .event-popup-buttons {
        display: flex;
        gap: 10px;
        justify-content: flex-end;
      }

      .event-popup button {
        background-color: var(
          --accent-color
        );
        color: #fff;
        border: none;
        padding: 8px 16px;
        border-radius: var(
          --border-radius
        );
        cursor: pointer;
      }

      .event-popup button.delete {
        background-color: #dc2626;
      }

      .overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(
          0,
          0,
          0,
          0.7
        );
        z-index: 1001;
      }
    </style>
  </head>
  <body>
    <!-- Auth Buttons -->
    <div class="auth-buttons">
      <button
        id="logout-btn"
        style="display: none"
        onclick="logout()"
      >
        Logout
      </button>
      <button
        onclick="openModal('login')"
      >
        Login
      </button>
      <button
        onclick="openModal('signup')"
      >
        Sign Up
      </button>
    </div>

    <!-- Theme Toggle Switch -->
    <div class="theme-toggle">
      <input
        type="checkbox"
        id="theme-switch"
        onclick="toggleTheme()"
      />
      <label for="theme-switch"></label>
    </div>

    <!-- Login Modal -->
    <div class="modal" id="login-modal">
      <div class="modal-content">
        <h2>Login</h2>
        <input
          type="text"
          id="login-username"
          placeholder="Username"
        />
        <input
          type="password"
          id="login-password"
          placeholder="Password"
        />
        <button onclick="login()">
          Login
        </button>
        <div
          class="switch"
          onclick="openModal('signup')"
        >
          Don't have an account? Sign Up
        </div>
        <div
          class="error"
          id="login-error"
        ></div>
      </div>
    </div>

    <!-- Sign-Up Modal -->
    <div
      class="modal"
      id="signup-modal"
    >
      <div class="modal-content">
        <h2>Sign Up</h2>
        <input
          type="text"
          id="signup-username"
          placeholder="Username"
        />
        <input
          type="password"
          id="signup-password"
          placeholder="Password"
        />
        <button onclick="signUp()">
          Sign Up
        </button>
        <div
          class="switch"
          onclick="openModal('login')"
        >
          Already have an account? Login
        </div>
        <div
          class="error"
          id="signup-error"
        ></div>
      </div>
    </div>

    <!-- Video Background -->
    <div class="video-background">
      <video
        autoplay
        muted
        loop
        id="lofi-video"
        preload="auto"
      >
        <source
          src="videoplayback.mp4.crdownload"
          type="video/mp4"
        />
        Your browser does not support
        the video tag.
      </video>
      <div class="video-overlay"></div>
    </div>

    <!-- Hero Section -->
    <section class="hero">
      <div class="hero-content">
        <h1 id="hero-title">
          Hello, nice to meet you!
        </h1>
        <p>
          Relax, focus, and get things
          done.
        </p>
      </div>
    </section>

    <!-- Main Content -->
    <div class="container">
      <!-- Pomodoro Timer with Analog Clock -->
      <div class="card">
        <div class="card-icon">
          <i class="fas fa-clock"></i>
        </div>
        <div
          class="card-content pomodoro-timer"
        >
          <h2>Pomodoro Timer</h2>
          <div class="timer-settings">
            <div>
              <label for="work-time"
                >Work (minutes):</label
              >
              <input
                type="number"
                id="work-time"
                value="25"
                min="1"
              />
            </div>
            <div>
              <label for="break-time"
                >Break (minutes):</label
              >
              <input
                type="number"
                id="break-time"
                value="5"
                min="1"
              />
            </div>
          </div>
          <div class="timer-display">
            25:00
          </div>
          <div class="timer-controls">
            <button
              onclick="startTimer()"
            >
              Start
            </button>
            <button
              onclick="pauseTimer()"
            >
              Pause
            </button>
            <button
              onclick="resetTimer()"
            >
              Reset
            </button>
          </div>
        </div>
        <!-- Analog Clock -->
        <div class="analog-clock">
          <div class="clock-face">
            <div
              class="hand hour-hand"
            ></div>
            <div
              class="hand minute-hand"
            ></div>
            <div
              class="hand second-hand"
            ></div>
          </div>
        </div>
      </div>

      <!-- To-Do List Section -->
      <div class="card">
        <div class="card-icon">
          <i class="fas fa-tasks"></i>
        </div>
        <div
          class="card-content todo-list"
        >
          <h2>To-Do List</h2>
          <div class="todo-input">
            <input
              type="text"
              id="task-input"
              placeholder="Add a new task"
            />
            <button onclick="addTask()">
              Add
            </button>
          </div>
          <ul
            class="todo-items"
            id="todo-items"
          ></ul>
        </div>
      </div>

      <!-- Spotify Player Section -->
      <div class="card">
        <div class="card-icon">
          <i class="fas fa-music"></i>
        </div>
        <div
          class="card-content spotify-player"
        >
          <h2>Spotify Player</h2>
          <div class="spotify-controls">
            <input
              type="text"
              id="spotify-link"
              placeholder="Paste Spotify playlist link"
            />
            <button
              onclick="addSpotifyPlaylist()"
            >
              Add Playlist
            </button>
          </div>
          <div
            class="spotify-grid"
            id="spotify-grid"
          >
            <!-- Playlists will be added here -->
          </div>
        </div>
      </div>

      <!-- Workout Planner Section -->
      <div class="card">
        <div class="card-icon">
          <i
            class="fas fa-dumbbell"
          ></i>
        </div>
        <div
          class="card-content workout-planner"
        >
          <h2>Workout Planner</h2>
          <div class="workout-controls">
            <button
              onclick="addWorkoutDay()"
            >
              Add Day
            </button>
            <button
              onclick="saveWorkoutPlan()"
            >
              Save Plan
            </button>
          </div>
          <div id="workout-days">
            <!-- Workout days will be added here -->
          </div>
        </div>
      </div>

      <!-- Calendar Section -->
      <div class="card">
        <div class="card-icon">
          <i
            class="fas fa-calendar-alt"
          ></i>
        </div>
        <div
          class="card-content calendar"
        >
          <h2>Calendar</h2>
          <div class="calendar-header">
            <button
              onclick="previousMonth()"
            >
              ←
            </button>
            <span id="current-month"
              >Month Year</span
            >
            <button
              onclick="nextMonth()"
            >
              →
            </button>
          </div>
          <div
            class="calendar-grid"
            id="calendar-grid"
          ></div>
        </div>
      </div>
    </div>

    <!-- Footer -->
    <footer>
      <p>
        © 2025 Cozy LoFi Chill. All
        rights reserved.
      </p>
    </footer>

    <script>
      // Theme Toggle Function
      function toggleTheme() {
        const body = document.body;
        if (
          body.getAttribute(
            "data-theme"
          ) === "light"
        ) {
          body.setAttribute(
            "data-theme",
            "dark"
          );
          localStorage.setItem(
            "theme",
            "dark"
          );
        } else {
          body.setAttribute(
            "data-theme",
            "light"
          );
          localStorage.setItem(
            "theme",
            "light"
          );
        }
      }

      // User data management
      const USER_DATA_KEY =
        "cozy_lofi_users";
      let currentUser = null;
      let currentDate = new Date();
      const calendarGrid =
        document.getElementById(
          "calendar-grid"
        );
      const currentMonthDisplay =
        document.getElementById(
          "current-month"
        );

      // Initialize user data storage
      function initUserStorage() {
        if (
          !localStorage.getItem(
            USER_DATA_KEY
          )
        ) {
          localStorage.setItem(
            USER_DATA_KEY,
            JSON.stringify({})
          );
        }
      }

      // Get all users
      function getAllUsers() {
        return (
          JSON.parse(
            localStorage.getItem(
              USER_DATA_KEY
            )
          ) || {}
        );
      }

      // Save all users
      function saveAllUsers(users) {
        localStorage.setItem(
          USER_DATA_KEY,
          JSON.stringify(users)
        );
      }

      // Get current user data
      function getCurrentUserData() {
        if (!currentUser) return null;
        const users = getAllUsers();
        return (
          users[currentUser.username] ||
          null
        );
      }

      // Save current user data
      function saveCurrentUserData(
        userData
      ) {
        if (!currentUser) return;
        const users = getAllUsers();
        users[currentUser.username] =
          userData;
        saveAllUsers(users);
      }

      // Authentication Functions
      function signUp() {
        const username = document
          .getElementById(
            "signup-username"
          )
          .value.trim();
        const password = document
          .getElementById(
            "signup-password"
          )
          .value.trim();

        if (!username || !password) {
          document.getElementById(
            "signup-error"
          ).textContent =
            "Please fill in all fields.";
          return;
        }

        const users = getAllUsers();

        if (users[username]) {
          document.getElementById(
            "signup-error"
          ).textContent =
            "Username already exists.";
          return;
        }

        // Create new user with default data
        users[username] = {
          password: password,
          todos: [],
          spotifyPlaylists: [],
          workoutPlan: {},
          calendarEvents: {},
        };

        saveAllUsers(users);

        // Log the user in
        currentUser = { username };
        updateAuthUI();
        loadUserData();
        alert("Sign-up successful!");
        closeModal();
      }

      function login() {
        const username = document
          .getElementById(
            "login-username"
          )
          .value.trim();
        const password = document
          .getElementById(
            "login-password"
          )
          .value.trim();

        const users = getAllUsers();
        const userData =
          users[username];

        if (
          userData &&
          userData.password === password
        ) {
          currentUser = { username };
          updateAuthUI();
          loadUserData();
          closeModal();
        } else {
          document.getElementById(
            "login-error"
          ).textContent =
            "Invalid username or password";
        }
      }

      function logout() {
        saveUserData();
        currentUser = null;
        updateAuthUI();
        clearUserData();
      }

      function updateAuthUI() {
        const logoutBtn =
          document.getElementById(
            "logout-btn"
          );
        const authButtons =
          document.querySelector(
            ".auth-buttons"
          );

        if (currentUser) {
          updateHeroTitle(
            currentUser.username
          );
          logoutBtn.style.display =
            "block";
          authButtons.querySelector(
            "button:nth-child(2)"
          ).style.display = "none";
          authButtons.querySelector(
            "button:nth-child(3)"
          ).style.display = "none";
        } else {
          updateHeroTitle(
            "Hello, nice to meet you!"
          );
          logoutBtn.style.display =
            "none";
          authButtons.querySelector(
            "button:nth-child(2)"
          ).style.display = "block";
          authButtons.querySelector(
            "button:nth-child(3)"
          ).style.display = "block";
        }
      }

      // Update Hero Title
      function updateHeroTitle(
        username
      ) {
        const heroTitle =
          document.getElementById(
            "hero-title"
          );
        heroTitle.textContent = username
          ? `Hello, ${username}!`
          : "Hello, nice to meet you!";
      }

      // User Data Management
      function saveUserData() {
        if (!currentUser) return;

        // Save todos
        const todos = [];
        document
          .querySelectorAll(
            "#todo-items li"
          )
          .forEach((li) => {
            todos.push({
              text: li.querySelector(
                ".task-text"
              ).textContent,
              completed:
                li.classList.contains(
                  "completed"
                ),
            });
          });

        // Save Spotify playlists
        const spotifyPlaylists =
          Array.from(
            document.querySelectorAll(
              "#spotify-grid iframe"
            )
          ).map((iframe) => iframe.src);

        // Save workout plan
        const workoutPlan = {};
        document
          .querySelectorAll(
            ".workout-day"
          )
          .forEach((dayElement) => {
            const dayName =
              dayElement.dataset.day;
            workoutPlan[dayName] = [];

            dayElement
              .querySelectorAll(
                ".workout-exercise"
              )
              .forEach(
                (exerciseElement) => {
                  workoutPlan[
                    dayName
                  ].push({
                    name: exerciseElement.querySelector(
                      ".exercise-name"
                    ).value,
                    sets: exerciseElement.querySelector(
                      ".exercise-sets"
                    ).value,
                    reps: exerciseElement.querySelector(
                      ".exercise-reps"
                    ).value,
                    startTime:
                      exerciseElement.querySelector(
                        ".exercise-start-time"
                      ).value,
                    endTime:
                      exerciseElement.querySelector(
                        ".exercise-end-time"
                      ).value,
                  });
                }
              );
          });

        // Save calendar events
        const calendarEvents = {};
        document
          .querySelectorAll(
            ".calendar-day.event"
          )
          .forEach((day) => {
            if (day.dataset.dateKey) {
              calendarEvents[
                day.dataset.dateKey
              ] = day.dataset.event;
            }
          });

        // Update user data
        const users = getAllUsers();
        users[currentUser.username] = {
          ...users[
            currentUser.username
          ],
          todos,
          spotifyPlaylists,
          workoutPlan,
          calendarEvents,
        };
        saveAllUsers(users);
      }

      function loadUserData() {
        if (!currentUser) return;

        const userData =
          getCurrentUserData();
        if (!userData) return;

        // Load todos
        const todoItems =
          document.getElementById(
            "todo-items"
          );
        todoItems.innerHTML = "";
        (userData.todos || []).forEach(
          (todo) => {
            addTodoItem(
              todo.text,
              todo.completed
            );
          }
        );

        // Load Spotify playlists
        const spotifyGrid =
          document.getElementById(
            "spotify-grid"
          );
        spotifyGrid.innerHTML = "";
        (
          userData.spotifyPlaylists ||
          []
        ).forEach((url) => {
          document.getElementById(
            "spotify-link"
          ).value = url;
          addSpotifyPlaylist();
        });

        // Load workout plan
        const workoutDaysContainer =
          document.getElementById(
            "workout-days"
          );
        workoutDaysContainer.innerHTML =
          "";
        if (userData.workoutPlan) {
          for (const dayName in userData.workoutPlan) {
            addWorkoutDay(
              dayName,
              userData.workoutPlan[
                dayName
              ]
            );
          }
        }

        // Load calendar events
        renderCalendar();
      }

      function clearUserData() {
        document.getElementById(
          "todo-items"
        ).innerHTML = "";
        document.getElementById(
          "spotify-grid"
        ).innerHTML = "";
        document.getElementById(
          "workout-days"
        ).innerHTML = "";
        renderCalendar();
      }

      // Modal Functions
      function openModal(type) {
        const loginModal =
          document.getElementById(
            "login-modal"
          );
        const signupModal =
          document.getElementById(
            "signup-modal"
          );

        if (type === "login") {
          loginModal.style.display =
            "flex";
          signupModal.style.display =
            "none";
          document.getElementById(
            "login-error"
          ).textContent = "";
        } else if (type === "signup") {
          signupModal.style.display =
            "flex";
          loginModal.style.display =
            "none";
          document.getElementById(
            "signup-error"
          ).textContent = "";
        }
      }

      function closeModal() {
        document.getElementById(
          "login-modal"
        ).style.display = "none";
        document.getElementById(
          "signup-modal"
        ).style.display = "none";
      }

      // Close modal when clicking outside
      window.onclick = function (
        event
      ) {
        const loginModal =
          document.getElementById(
            "login-modal"
          );
        const signupModal =
          document.getElementById(
            "signup-modal"
          );

        if (
          event.target === loginModal ||
          event.target === signupModal
        ) {
          closeModal();
        }
      };

      // Improved Pomodoro Timer with background operation and immediate beeping
      let timer;
      let timeLeft = 1500; // 25 minutes in seconds
      let isWorkTime = true;
      let lastUpdateTime = Date.now();
      let isPaused = false;
      const timerDisplay =
        document.querySelector(
          ".timer-display"
        );
      const workTimeInput =
        document.getElementById(
          "work-time"
        );
      const breakTimeInput =
        document.getElementById(
          "break-time"
        );

      // Audio context for reliable sound
      let audioContext;

      function initAudio() {
        try {
          audioContext =
            new (window.AudioContext ||
              window.webkitAudioContext)();
        } catch (e) {
          console.log(
            "Web Audio API not supported, using fallback"
          );
        }
      }

      function playBeep() {
        // Try Web Audio API first
        if (audioContext) {
          for (let i = 0; i < 3; i++) {
            setTimeout(() => {
              const oscillator =
                audioContext.createOscillator();
              const gainNode =
                audioContext.createGain();

              oscillator.type =
                "square";
              oscillator.frequency.value = 800;
              gainNode.gain.value = 0.5;

              oscillator.connect(
                gainNode
              );
              gainNode.connect(
                audioContext.destination
              );

              const now =
                audioContext.currentTime;
              gainNode.gain.setValueAtTime(
                0.5,
                now
              );
              gainNode.gain.exponentialRampToValueAtTime(
                0.001,
                now + 0.2
              );
              oscillator.start(now);
              oscillator.stop(
                now + 0.2
              );
            }, i * 300);
          }
        }
        // Fallback to browser beep
        else {
          for (let i = 0; i < 3; i++) {
            setTimeout(
              () => console.log("\x07"),
              i * 300
            );
          }
        }
      }

      function startTimer() {
        if (!timer && !isPaused) {
          lastUpdateTime = Date.now();
          timer = setInterval(
            updateTimer,
            1000
          );
          updateTitle();
        }
        isPaused = false;
      }

      function pauseTimer() {
        if (timer) {
          clearInterval(timer);
          timer = null;
          isPaused = true;
          document.title =
            "Paused | Cozy LoFi";
        }
      }

      function resetTimer() {
        clearInterval(timer);
        timer = null;
        isPaused = false;
        timeLeft = isWorkTime
          ? workTimeInput.value * 60
          : breakTimeInput.value * 60;
        updateDisplay();
        updateTitle();
      }

      function updateTimer() {
        const now = Date.now();
        const elapsedSeconds =
          Math.floor(
            (now - lastUpdateTime) /
              1000
          );
        lastUpdateTime = now;

        timeLeft = Math.max(
          0,
          timeLeft - elapsedSeconds
        );

        if (timeLeft <= 0) {
          timeLeft = 0;
          clearInterval(timer);
          timer = null;
          updateDisplay();
          playBeep(); // Play sound immediately

          // Show alert after sound plays
          setTimeout(() => {
            alert(
              isWorkTime
                ? "Time for a break!"
                : "Back to work!"
            );
            isWorkTime = !isWorkTime;
            timeLeft =
              (isWorkTime
                ? workTimeInput.value
                : breakTimeInput.value) *
              60;
            startTimer();
          }, 100);
        }

        updateDisplay();
      }

      function updateDisplay() {
        const minutes = Math.floor(
          timeLeft / 60
        );
        const seconds = timeLeft % 60;
        timerDisplay.textContent = `${minutes}:${seconds
          .toString()
          .padStart(2, "0")}`;
        updateTitle();
      }

      function updateTitle() {
        document.title = `${timerDisplay.textContent} | Cozy LoFi`;
      }

      // Handle visibility change for background timer
      document.addEventListener(
        "visibilitychange",
        function () {
          if (
            document.hidden &&
            timer
          ) {
            // Tab is hidden - ensure timer keeps accurate time
            lastUpdateTime = Date.now();
          }
        }
      );

      // Analog Clock Functionality
      function updateClock() {
        const now = new Date();
        const hourHand =
          document.querySelector(
            ".hour-hand"
          );
        const minuteHand =
          document.querySelector(
            ".minute-hand"
          );
        const secondHand =
          document.querySelector(
            ".second-hand"
          );

        const hours =
          now.getHours() % 12;
        const minutes =
          now.getMinutes();
        const seconds =
          now.getSeconds();

        const hourDeg =
          hours * 30 + minutes * 0.5;
        const minuteDeg =
          minutes * 6 + seconds * 0.1;
        const secondDeg = seconds * 6;

        hourHand.style.transform = `rotate(${hourDeg}deg)`;
        minuteHand.style.transform = `rotate(${minuteDeg}deg)`;
        secondHand.style.transform = `rotate(${secondDeg}deg)`;
      }

      setInterval(updateClock, 1000);
      updateClock();

      // Improved To-Do List
      function addTask() {
        const taskInput =
          document.getElementById(
            "task-input"
          );
        if (
          taskInput.value.trim() === ""
        )
          return;

        addTodoItem(taskInput.value);
        taskInput.value = "";
        saveUserData();
      }

      function addTodoItem(
        text,
        completed = false
      ) {
        const todoItems =
          document.getElementById(
            "todo-items"
          );
        const taskItem =
          document.createElement("li");
        if (completed)
          taskItem.classList.add(
            "completed"
          );

        const taskText =
          document.createElement(
            "span"
          );
        taskText.classList.add(
          "task-text"
        );
        taskText.textContent = text;
        taskItem.appendChild(taskText);

        const buttonsContainer =
          document.createElement("div");
        buttonsContainer.classList.add(
          "task-buttons"
        );

        const completeButton =
          document.createElement(
            "button"
          );
        completeButton.textContent =
          "Complete";
        completeButton.onclick = () => {
          taskItem.classList.toggle(
            "completed"
          );
          saveUserData();
        };

        const deleteButton =
          document.createElement(
            "button"
          );
        deleteButton.textContent =
          "Delete";
        deleteButton.onclick = () => {
          taskItem.remove();
          saveUserData();
        };

        buttonsContainer.appendChild(
          completeButton
        );
        buttonsContainer.appendChild(
          deleteButton
        );
        taskItem.appendChild(
          buttonsContainer
        );
        todoItems.appendChild(taskItem);
      }

      // Workout Planner Functions
      function addWorkoutDay(
        dayName = "",
        exercises = []
      ) {
        const workoutDaysContainer =
          document.getElementById(
            "workout-days"
          );

        if (!dayName) {
          dayName = prompt(
            "Enter day name (e.g., Monday, Chest Day):"
          );
          if (!dayName) return;
        }

        const dayElement =
          document.createElement("div");
        dayElement.className =
          "workout-day";
        dayElement.dataset.day =
          dayName;

        const dayHeader =
          document.createElement("div");
        dayHeader.className =
          "workout-day-header";

        const dayTitle =
          document.createElement("h3");
        dayTitle.className =
          "workout-day-title";
        dayTitle.textContent = dayName;

        const dayActions =
          document.createElement("div");
        dayActions.className =
          "exercise-actions";

        const addExerciseBtn =
          document.createElement(
            "button"
          );
        addExerciseBtn.textContent =
          "Add Exercise";
        addExerciseBtn.onclick = () =>
          addExerciseToDay(dayElement);

        const deleteDayBtn =
          document.createElement(
            "button"
          );
        deleteDayBtn.textContent =
          "Delete Day";
        deleteDayBtn.style.backgroundColor =
          "#dc2626";
        deleteDayBtn.onclick = () => {
          if (
            confirm(
              `Delete ${dayName} workout day?`
            )
          ) {
            dayElement.remove();
            saveUserData();
          }
        };

        dayActions.appendChild(
          addExerciseBtn
        );
        dayActions.appendChild(
          deleteDayBtn
        );
        dayHeader.appendChild(dayTitle);
        dayHeader.appendChild(
          dayActions
        );

        const exercisesContainer =
          document.createElement("div");
        exercisesContainer.className =
          "workout-exercises";

        dayElement.appendChild(
          dayHeader
        );
        dayElement.appendChild(
          exercisesContainer
        );
        workoutDaysContainer.appendChild(
          dayElement
        );

        // Add exercises if provided
        exercises.forEach(
          (exercise) => {
            addExerciseToDay(
              dayElement,
              exercise
            );
          }
        );
      }

      function addExerciseToDay(
        dayElement,
        exercise = null
      ) {
        const exercisesContainer =
          dayElement.querySelector(
            ".workout-exercises"
          );

        const exerciseElement =
          document.createElement("div");
        exerciseElement.className =
          "workout-exercise";

        // Exercise Name
        const nameInput =
          document.createElement(
            "input"
          );
        nameInput.type = "text";
        nameInput.className =
          "exercise-name";
        nameInput.placeholder =
          "Exercise name";
        nameInput.value = exercise
          ? exercise.name
          : "";

        // Sets (placeholder text)
        const setsInput =
          document.createElement(
            "input"
          );
        setsInput.type = "text";
        setsInput.className =
          "exercise-sets";
        setsInput.placeholder = "Sets";
        setsInput.value = exercise
          ? exercise.sets
          : "";

        // Reps (placeholder text)
        const repsInput =
          document.createElement(
            "input"
          );
        repsInput.type = "text";
        repsInput.className =
          "exercise-reps";
        repsInput.placeholder = "Reps";
        repsInput.value = exercise
          ? exercise.reps
          : "";

        // Start Time
        const startTimeInput =
          document.createElement(
            "input"
          );
        startTimeInput.type = "time";
        startTimeInput.className =
          "exercise-start-time";
        startTimeInput.placeholder =
          "Start Time";
        startTimeInput.value = exercise
          ? exercise.startTime
          : "";

        // End Time
        const endTimeInput =
          document.createElement(
            "input"
          );
        endTimeInput.type = "time";
        endTimeInput.className =
          "exercise-end-time";
        endTimeInput.placeholder =
          "End Time";
        endTimeInput.value = exercise
          ? exercise.endTime
          : "";

        // Input container
        const inputContainer =
          document.createElement("div");
        inputContainer.className =
          "exercise-inputs";
        inputContainer.append(
          nameInput,
          setsInput,
          repsInput,
          startTimeInput,
          endTimeInput
        );

        // Delete button
        const deleteBtn =
          document.createElement(
            "button"
          );
        deleteBtn.textContent = "×";
        deleteBtn.className =
          "delete-exercise";
        deleteBtn.onclick = () => {
          exerciseElement.remove();
          saveUserData();
        };

        exerciseElement.append(
          inputContainer,
          deleteBtn
        );
        exercisesContainer.appendChild(
          exerciseElement
        );
      }

      function saveWorkoutPlan() {
        saveUserData();
        alert("Workout plan saved!");
      }

      // Improved Calendar with Event Management
      function renderCalendar() {
        calendarGrid.innerHTML = "";
        const year =
          currentDate.getFullYear();
        const month =
          currentDate.getMonth();
        const firstDay = new Date(
          year,
          month,
          1
        );
        const lastDay = new Date(
          year,
          month + 1,
          0
        );
        const daysInMonth =
          lastDay.getDate();
        const startingDay =
          firstDay.getDay();

        currentMonthDisplay.textContent = `${firstDay.toLocaleString(
          "default",
          { month: "long" }
        )} ${year}`;

        // Add empty cells for days of previous month
        for (
          let i = 0;
          i < startingDay;
          i++
        ) {
          const emptyDay =
            document.createElement(
              "div"
            );
          emptyDay.classList.add(
            "calendar-day",
            "empty"
          );
          calendarGrid.appendChild(
            emptyDay
          );
        }

        // Add cells for current month
        for (
          let i = 1;
          i <= daysInMonth;
          i++
        ) {
          const day =
            document.createElement(
              "div"
            );
          day.classList.add(
            "calendar-day"
          );
          day.textContent = i;

          // Check for events on this day
          const dateKey = `${year}-${String(
            month + 1
          ).padStart(2, "0")}-${String(
            i
          ).padStart(2, "0")}`;
          const userData =
            getCurrentUserData();
          if (
            userData?.calendarEvents?.[
              dateKey
            ]
          ) {
            day.classList.add("event");
            day.dataset.event =
              userData.calendarEvents[
                dateKey
              ];
            day.dataset.dateKey =
              dateKey;
          }

          day.onclick = () =>
            handleDayClick(day);
          calendarGrid.appendChild(day);
        }
      }

      function handleDayClick(day) {
        if (
          day.classList.contains(
            "event"
          )
        ) {
          showEventPopup(day);
        } else {
          const event = prompt(
            "Enter event for this day:"
          );
          if (
            event &&
            event.trim() !== ""
          ) {
            day.classList.add("event");
            day.dataset.event = event;
            const dateKey = `${currentDate.getFullYear()}-${String(
              currentDate.getMonth() + 1
            ).padStart(
              2,
              "0"
            )}-${day.textContent.padStart(
              2,
              "0"
            )}`;
            day.dataset.dateKey =
              dateKey;
            saveCalendarEvent(
              dateKey,
              event
            );
          }
        }
      }

      function saveCalendarEvent(
        dateKey,
        eventText
      ) {
        if (!currentUser) return;

        const users = getAllUsers();

        if (
          !users[currentUser.username]
            .calendarEvents
        ) {
          users[
            currentUser.username
          ].calendarEvents = {};
        }

        users[
          currentUser.username
        ].calendarEvents[dateKey] =
          eventText;
        saveAllUsers(users);
      }

      function deleteCalendarEvent(
        dateKey
      ) {
        if (!currentUser) return;

        const users = getAllUsers();

        if (
          users[currentUser.username]
            .calendarEvents &&
          users[currentUser.username]
            .calendarEvents[dateKey]
        ) {
          delete users[
            currentUser.username
          ].calendarEvents[dateKey];
          saveAllUsers(users);
        }

        // Re-render calendar to reflect changes
        renderCalendar();
      }

      function showEventPopup(
        dayElement
      ) {
        const eventText =
          dayElement.dataset.event;
        const dateKey =
          dayElement.dataset.dateKey;
        const [year, month, day] =
          dateKey.split("-");
        const date = new Date(
          year,
          month - 1,
          day
        );

        const popup =
          document.createElement("div");
        popup.classList.add(
          "event-popup"
        );

        const overlay =
          document.createElement("div");
        overlay.classList.add(
          "overlay"
        );

        popup.innerHTML = `
            <h3>Event on ${date.toLocaleDateString(
              "default",
              {
                month: "long",
                day: "numeric",
                year: "numeric",
              }
            )}</h3>
            <p>${eventText}</p>
            <div class="event-popup-buttons">
                <button class="delete" onclick="handleDeleteEvent('${dateKey}')">Delete</button>
                <button onclick="closePopup()">Close</button>
            </div>
            `;

        overlay.appendChild(popup);
        document.body.appendChild(
          overlay
        );

        // Store references for closing
        window.currentPopup = {
          overlay,
          popup,
        };
      }

      function handleDeleteEvent(
        dateKey
      ) {
        deleteCalendarEvent(dateKey);
        closePopup();
      }

      function closePopup() {
        if (window.currentPopup) {
          document.body.removeChild(
            window.currentPopup.overlay
          );
          window.currentPopup = null;
        }
      }

      function previousMonth() {
        currentDate.setMonth(
          currentDate.getMonth() - 1
        );
        renderCalendar();
      }

      function nextMonth() {
        currentDate.setMonth(
          currentDate.getMonth() + 1
        );
        renderCalendar();
      }

      // Make delete function available globally
      window.handleDeleteEvent =
        handleDeleteEvent;

      // Spotify Playlist Functionality
      function addSpotifyPlaylist() {
        const playlistInput =
          document.getElementById(
            "spotify-link"
          );
        const spotifyGrid =
          document.getElementById(
            "spotify-grid"
          );

        if (!playlistInput.value.trim())
          return;

        let playlistUrl =
          playlistInput.value.trim();

        // Convert regular Spotify links to embed links
        if (
          playlistUrl.includes(
            "open.spotify.com/playlist/"
          )
        ) {
          playlistUrl =
            playlistUrl.replace(
              "open.spotify.com/playlist/",
              "open.spotify.com/embed/playlist/"
            );
        }

        // Create the iframe
        const iframe =
          document.createElement(
            "iframe"
          );
        iframe.src = playlistUrl;
        iframe.frameBorder = "0";
        iframe.allowTransparency =
          "true";
        iframe.allow =
          "encrypted-media";
        iframe.style.width = "100%";
        iframe.style.height = "80px";
        iframe.style.borderRadius =
          "12px";

        // Create a container for the iframe with delete button
        const playerContainer =
          document.createElement("div");
        playerContainer.style.position =
          "relative";

        const deleteButton =
          document.createElement(
            "button"
          );
        deleteButton.textContent = "×";
        deleteButton.style.position =
          "absolute";
        deleteButton.style.top = "5px";
        deleteButton.style.right =
          "5px";
        deleteButton.style.background =
          "red";
        deleteButton.style.border =
          "none";
        deleteButton.style.borderRadius =
          "50%";
        deleteButton.style.width =
          "20px";
        deleteButton.style.height =
          "20px";
        deleteButton.style.color =
          "white";
        deleteButton.style.cursor =
          "pointer";
        deleteButton.style.display =
          "flex";
        deleteButton.style.alignItems =
          "center";
        deleteButton.style.justifyContent =
          "center";
        deleteButton.style.padding =
          "0";
        deleteButton.style.fontSize =
          "14px";
        deleteButton.onclick = () => {
          playerContainer.remove();
          saveUserData();
        };

        playerContainer.appendChild(
          iframe
        );
        playerContainer.appendChild(
          deleteButton
        );

        spotifyGrid.appendChild(
          playerContainer
        );
        playlistInput.value = "";
        saveUserData();
      }

      // Video Parallax Effect
      document.addEventListener(
        "scroll",
        function () {
          const video =
            document.querySelector(
              ".video-background video"
            );
          const scrollTop =
            window.pageYOffset;
          const scrollPercent =
            scrollTop /
            (document.body
              .scrollHeight -
              window.innerHeight);
          const parallaxOffset =
            scrollPercent * 50;
          video.style.transform = `translateY(${parallaxOffset}px)`;
        }
      );

      // Initialize
      document.addEventListener(
        "DOMContentLoaded",
        () => {
          initAudio();
          initUserStorage();

          // Load theme preference
          const savedTheme =
            localStorage.getItem(
              "theme"
            );
          if (savedTheme === "light") {
            document.body.setAttribute(
              "data-theme",
              "light"
            );
            document.getElementById(
              "theme-switch"
            ).checked = true;
          }

          // Check if user was logged in
          const lastUser =
            sessionStorage.getItem(
              "lastUser"
            );
          if (lastUser) {
            const users = getAllUsers();
            if (users[lastUser]) {
              currentUser = {
                username: lastUser,
              };
              updateAuthUI();
              loadUserData();
            }
          }

          // Initial render
          renderCalendar();

          // Save last user on page unload
          window.addEventListener(
            "beforeunload",
            () => {
              if (currentUser) {
                saveUserData();
                sessionStorage.setItem(
                  "lastUser",
                  currentUser.username
                );
              } else {
                sessionStorage.removeItem(
                  "lastUser"
                );
              }
            }
          );
        }
      );
    </script>
  </body>
</html>
